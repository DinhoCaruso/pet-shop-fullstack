<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cadastro - Dinho's Pet Shop</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            background-image: url('cute-pet-accessories-still-life-concept.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: flex-start;
        }

        .card {
            background: rgba(255, 255, 255, 0.94);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            width: 380px;
            margin: 40px;
        }

        h2 { text-align: center; color: #2c3e50; margin-top: 0; }
        label { display: block; margin-top: 15px; font-weight: bold; color: #444; }

        input, select {
            width: 100%; padding: 12px; margin-top: 5px;
            border: 1px solid #ccc; border-radius: 8px;
            box-sizing: border-box; font-size: 16px;
        }

        .btn-principal {
            width: 100%; padding: 14px; background-color: #28a745; color: white;
            border: none; border-radius: 8px; cursor: pointer;
            font-weight: bold; margin-top: 25px; font-size: 16px;
            transition: 0.3s;
        }
        .btn-principal:hover { background-color: #218838; }

        .btn-navegacao {
            width: 100%; padding: 12px; background-color: #2196F3; color: white;
            border: none; border-radius: 8px; cursor: pointer;
            font-weight: bold; margin-top: 12px; font-size: 14px;
            transition: 0.3s;
        }

        /* Estilo para o bot√£o de cancelar edi√ß√£o */
        .btn-cancelar {
            width: 100%; padding: 10px; background-color: #6c757d; color: white;
            border: none; border-radius: 8px; cursor: pointer;
            margin-top: 10px; font-size: 13px;
        }
    </style>
</head>
<body>

<div class="card">
    <h2 id="titulo-form">üêæ Cadastro Pet Shop</h2>

    <label>Nome do Pet</label>
    <input type="text" id="nome" placeholder="Ex: Blunt">

    <label>Tipo de Animal</label>
    <select id="especie">
        <option value="Cachorro">Cachorro üê∂</option>
        <option value="Gato">Gato üê±</option>
    </select>

    <label>Nome do Dono</label>
    <input type="text" id="dono" placeholder="Ex: Dinho">

    <button id="btn-acao" class="btn-principal" onclick="processarPet()">Finalizar Cadastro</button>

    <button class="btn-navegacao" onclick="window.location.href='pets.html'">
        üìã Ver Pets Cadastrados
    </button>

    <div id="area-cancelar"></div>
</div>

<script>
    const API_URL = "http://127.0.0.1:8000/pets/";
    let idEmEdicao = null;

    // Detecta se a p√°gina foi aberta para EDITAR um pet
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('id')) {
            idEmEdicao = urlParams.get('id');
            document.getElementById('nome').value = urlParams.get('nome');
            document.getElementById('especie').value = urlParams.get('especie');
            document.getElementById('dono').value = urlParams.get('dono');

            // Muda o visual para modo de EDI√á√ÉO
            document.getElementById('titulo-form').innerText = "‚úèÔ∏è Editar Cadastro";
            const btn = document.getElementById('btn-acao');
            btn.textContent = "Salvar Altera√ß√µes";
            btn.style.backgroundColor = "#ffc107";
            btn.style.color = "black";

            // Cria bot√£o de cancelar caso o usu√°rio desista de editar
            const btnCancel = document.createElement('button');
            btnCancel.textContent = "Cancelar e Voltar";
            btnCancel.className = "btn-cancelar";
            btnCancel.onclick = () => window.location.href = 'index.html';
            document.getElementById('area-cancelar').appendChild(btnCancel);
        }
    };

    async function processarPet() {
        const nome = document.getElementById('nome').value;
        const especie = document.getElementById('especie').value;
        const dono = document.getElementById('dono').value;

        if (!nome || !dono) {
            alert("Por favor, preencha todos os campos!");
            return;
        }

        // Se tiver um ID, usa PUT (atualizar), se n√£o, usa POST (criar)
        const metodo = idEmEdicao ? 'PUT' : 'POST';
        const urlFinal = idEmEdicao ? `${API_URL}${idEmEdicao}` : API_URL;
        const queryParams = `?nome=${encodeURIComponent(nome)}&especie=${encodeURIComponent(especie)}&dono=${encodeURIComponent(dono)}`;

        try {
            const response = await fetch(urlFinal + queryParams, { method: metodo });
            if (response.ok) {
                alert(idEmEdicao ? "Atualizado com sucesso" : "Cadastrado com sucesso! üöÄ");
                window.location.href = 'pets.html'; // Redireciona para a lista
            } else {
                alert("Erro ao processar dados.");
            }
        } catch (error) {
            alert("Erro de conex√£o! Verifique se o servidor Python est√° rodando.");
        }
    }
</script>

</body>
</html>